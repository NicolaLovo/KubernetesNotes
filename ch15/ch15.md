# Chapter 15 - Node Affinity

Taints and tolerations -> they have some limitations

- cannot add multiple conditions and expressions
- toleration gpu=true does not prevent pod to be scheduled on node without taints

Es.

- node1 has label disk=hdd, node2/node3 have label disk=ssd
- pod1 with affinity `disk=ssd` -> node2 or node3
- pod2 with affinity `disk!=ssd` -> node1
- pod3 with affinity `disk in (ssd, hdd)` -> any node

If someone updates the label of the node after the pod was scheduled, it depends on these properties:

- `requiredDuringSchedulingIgnoredDuringExecution`
  - "requiredDuringScheduling" -> if there are no nodes that satisfy the condition, the pod is not scheduled
  - after the pod has been scheduled no action is taken
- `preferredDuringSchedulingIgnoredDuringExecution`
  - "preferred" -> best effort
    - if there are no nodes with such label, or nodes with such label are full -> it will schedule the pod elsewhere
  - after the pod has been scheduled no action is taken

Commands:

- `kubectl get nodes --show-labels`
- `kubectl label node NODE_NAME disktype=ssd` -> assign a label to a node
- `kubectl label node NODE_NAME cpu-type=` -> blank value label

## Node affinity vs taints/tolerations

To ensure that a pod with a certain toleration is scheduled on a node with a matching taint, use an affinity on such pod and node

## Node affinity vs node selectors

Node selectors:

- simple
- but:
  - support only exact matches
  - no OR logic
  - no preferences (only hard requirements)
- legacy

Node affinity -> best practice

- required or preferred rules
- many operators
- recommended