# Chapter 26 - Network Policies

## Network flow in Kubernetes

Example: 3 tier web app

- web tier -> frontend: nginx
  - exposed to port 80 and 443
- application tier -> backend: nodejs
- database tier -> mySql
- assume no load balancer between user and web tier

Ingress/incoming flow:

```
user -> port 80/443 -> frontend -> port 80 -> backend -> port 3306 -> mysql
```

Egress/outgoing flow:

```
mysql -> backend -> frontend
```

Now assume each tier is hosted on a separate Kubernetes node: node A,B,C (1 pod for each tier)

- the user will communicate to the frontend through the control plane with ApiServer
- use Services to expose the pods' ports: everyone can communicate with everyone

```
frontend <-> backend
backend <-> database
database <-> frontend
```

This is implemented with a CNI provider (Container Network Interface) -> makes sure that pods are accessible in the Kubernetes cluster

- example providers (open source, k8s addos -> must be added manually): weave-net, flannel, calico, cilium
  - most popular: calico, cilium
- deploys one pod in each node (DaemonSet) -> makes networking possible

I want to make pods accessible only by pods that need to -> need to restrict the connection with Network Policies

## Network Policies

Enforced by the CNI plugin:

> [!IMPORTANT]
> Not every CNI supports network policies (e.g. flanne, kindnet)

`kubectl get netpol`

Network policies when applied are **default-deny** -> what traffic is not explicitly allowed, is forbidden